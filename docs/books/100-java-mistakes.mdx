---
draft: true
---

import LinkPreview from "@site/src/components/LinkPreview";

# 자바 코드의 품질을 높이는 100가지 방법

시작일 25/09/18

## 1. 코드 품질 관리

핵심 내용

- 코드 품질을 향상시키는 다양한 기법
- 정적 분석의 장단점
- 정적 분석 효과를 높이는 방법
- 테스트 및 어설션

### 코드 리뷰와 페어 프로그래밍

- 코드 리뷰: 커밋한 변경사항을 절차에 따라 동료들이 검토
  - 다른 배경과 생각을 가진 동료가 검토함으로 버그 방지 및 가독성, 성능 개선
  - what to look for in a code review 책 추천
- 페어 프로그래밍: 아예 두명의 프로그래머가 함께 개발
  - 작성과 동시에 리뷰하는 셈
  - 익스트림 프로그래밍, practical remote pair programming 추천

### 코드 스타일

- 코드스타일 중 일부는 버그를 줄이는 효과가 있다.
- 자바 롱타입 변수 대문자 L 사용

  - `10l` 대신 `10L`사용 - l이 숫자처럼 보일 수 있음

- if 문 한줄이어도 중괄호 사용
  - 이부분은 본인도 중괄호 스킵을 종종 사용 했는데, 생략하다가 조건이 추가되면 수정 범위가 커져 일관적으로 중괄호를 쓰는 쪽이 유지보수에 유리하다고 생각
- 검증된 스타일 가이드를 따르도록 설정
  - 프론트쪽은 보통 에어비앤비 스타일 가이드를 기본으로, 상황에 맞지 않는 규칙은 해제하는 방식으로 적용.

### 정적 분석

- 정적 분석: 자동화된 코드리뷰

  - 의심스럽고 에러 가능성이 높은 코드 지목
  - 특정 유형의 버그는 잘 찾지만, 사람은 간단히 찾을 수 있는걸 못찾는 경우도 많음
  - 코드리뷰를 대체 불가

- 정적 분석기: 정적 분석을 실행하는 툴
  - ESlint, IntelliJ IDEA...

### 자동화된 테스트

- 대표적인 버그 탐색 기술로 유닛테스트, 기능 테스트, 통합테스트등 다양한 유형이 있다.
- 저자는 프로퍼티 테스트를 선호
  - 프로그램으로 무작위 작업을 실행한 뒤, 특정 프로퍼티가 기대에 부합하거나, 작동결과가 예상범주안에 드는지 확인

### 뮤테이션 커버리지

- 테스트 과정에서 어플리케이션 코드를 변경 후, 테스트를 실행해 기존 테스트코드가 얼마나 잘 잡아내는지 확인
- 일반 테스트보다 소요시간이 몇배는 더 걸림
- 뮤테이션 커버리지를 사용하려면 먼저 라인 커버리지를 최소 90% 이상 높이는게 좋음

### 동적 분석

- 동적 분석: 코드 실행 중 버그를 찾는 방식
- 동시성과 관련된 구체적인 버그를 감지

### 코드 어설션

- 유닛테스트와 비슷한 방식으로 프로덕션 코드에 어설션 직접 추가

### 정리

- 버그 발생 빈도를 줄이거나, 발견 시기를 앞당길 순 있어도 만능은 없다
- 하나의 방식보단 여러방식을 골고루 사용하는 것이 합리적
- 유닛 테스트는 매우 중요하고, 유닛테스트를 통해 코드의 동작을 확인
- 테스트 커버리지 100%는 일반적으로 불가능하며, 100%라도 버그가 없다는 의미는 아님

## 2. 표현식

실수 001 숫자 연산자 우선순위 오해
실수 002 조건식의 괄호 누락
실수 003 덧셈이 아닌 결합으로 작동
실수 004 멀티라인 문자열 리터럴
실수 005 단항 덧셈 연산자
실수 006 조건 표현식의 묵시적 타입 변환
실수 007 비단락 논리 연산자 사용
실수 008 &&와 || 혼동
실수 009 잘못된 가변 인수 호출
실수 010 조건 연산자와 가변 인수 호출
실수 011 반환값 무시
실수 012 새롭게 생성된 객체를 사용하지 않음
실수 013 잘못된 메서드를 참조하는 바인딩
실수 014 메서드 참조 시 잘못된 메서드 지정
정리

CHAPTER 3 프로그램 구조
실수 015 잘못된 if-else 연쇄
실수 016 이전 조건의 다음 조건 지배
실수 017 switch 문 통과 실수
실수 018 구형 for 루프 오류
실수 019 루프 변수 미사용
실수 020 잘못된 루프 방향
실수 021 루프 오버플로
실수 022 멱등 루프 본문
실수 023 잘못된 초기화 순서
실수 024 누락된 슈퍼클래스 메서드 호출
실수 025 우발적인 정적 필드 선언
정리

CHAPTER 4 숫자
실수 026 우발적인 8진수 리터럴 사용
실수 027 수치 오버플로
실수 028 정수 나눗셈 중 반올림
실수 029 Integer.MIN_VALUE의 절댓값
실수 030 홀수 검사와 음수
실수 031 확장으로 인한 정밀도 손실
실수 032 무조건적인 축소 변환
실수 033 16진수 음수
실수 034 복합 할당의 묵시적 타입 변환
실수 035 나눗셈과 복합 할당
실수 036 short 타입
실수 037 비트 조작 알고리즘
실수 038 음수 바이트
실수 039 잘못된 클램핑 순서
실수 040 특수한 부동소수점 수
정리

CHAPTER 5 일반적인 예외
실수 041 NullPointerException
실수 042 IndexOutOfBoundsException
실수 043 ClassCastException
실수 044 StackOverflowError
정리

CHAPTER 6 문자열
실수 045 char 값을 문자로 간주
실수 046 대소문자 변환
실수 047 기본 로케일에서 String.format 사용
실수 048 포맷 인수 불일치
실수 049 정규 표현식 대신 일반 문자열 사용
실수 050 replaceAll 오용
실수 051 이스케이프 시퀀스 오용
실수 052 문자열의 대소문자 비교
실수 053 indexOf 메서드 결과 미확인
실수 054 indexOf 인수 오용
정리

CHAPTER 7 객체 비교
실수 055 equals 메서드 대신 참조 동등성 비교
실수 056 equals()가 내용을 비교한다고 간주함
실수 057 URL.equals() 사용
실수 058 스케일이 다른 BigDecimal 비교
실수 059 관련 없는 타입에 equals() 사용
실수 060 잘못된 equals() 구현
실수 061 배열 필드 hashCode()
실수 062 equals()와 hashCode() 불일치
실수 063 특정 반환값에 의존하는 compare()
실수 064 동일한 객체를 비교할 때 0을 반환하지 않음
실수 065 뺄셈을 이용한 숫자 비교
실수 066 비교 메서드가 반환하는 NaN 값 무시
실수 067 비교 메서드에서 객체를 키 시퀀스로 표현하지 못함
실수 068 비교자의 난수 반환
정리

CHAPTER 8 컬렉션과 맵
실수 069 관련 없는 객체 타입 검색
실수 070 단일 객체와 컬렉션 혼합
실수 071 null을 허용하지 않는 컬렉션에서 null을 검색함
실수 072 맵에서 null 값 사용
실수 073 수정 불가 컬렉션의 수정 시도
실수 074 가변 객체를 키로 사용
실수 075 HashMap 및 HashSet의 등장 순서 의존
실수 076 순회 도중 수정하기
실수 077 List.remove() 오버로드 오용
실수 078 List.remove() 직후 원소 생략
실수 079 Collection.removeIf() 내부의 컬렉션 조회
실수 080 Map.computeIfAbsent()의 동시 수정
실수 081 이터레이터 계약 위반
정리

CHAPTER 9 라이브러리 메서드
실수 082 StringBuilder 생성자에 char 전달
실수 083 스트림 API 체인에서 부수 효과를 일으킴
실수 084 스트림을 두 번 소비
실수 085 null 사용 불가 스트림에서 null 값 사용
실수 086 스트림 API 연산 계약 위반
실수 087 instanceof 대신 getClass()를 사용
실수 088 열거형, 어노테이션, 클래스에서 getClass()를 사용
실수 089 문자열을 불리언으로 잘못 변환
실수 090 잘못된 날짜 포맷
실수 091 약한 참조, 부드러운 참조의 우발적 무효화
실수 092 세상이 안정적이라는 가정
실수 093 동시 업데이트 데이터 구조에 대한 비원자적 접근
정리

CHAPTER 10 유닛 테스트
실수 094 assert 문의 부수 효과
실수 095 잘못된 assertion 메서드 호출
실수 096 잘못된 예외 테스트
실수 097 테스트 메서드 조기 종료
실수 098 유닛 테스트에서 AssertionError 무시하기
실수 099 assertNotEquals()로 동등성 비교하기
실수 100 양식이 잘못된 테스트 메서드
정리

APPENDIX A 정적 분석 어노테이션
어노테이션 패키지
어노테이션 종류

APPENDIX B 정적 분석 툴 확장
Error Prone 플러그인
SpotBugs 플러그인
IntelliJ IDEA 플러그인
IntelliJ IDEA의 구조적 검색 및 교체 기능
