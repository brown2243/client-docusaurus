---
slug: memory-architecture
title: 프로그램 메모리 구조

authors: [brown]
tags: [memory, stack, heap]
Date: 2024-04-11 14:00
---

# 프로그램 메모리 구조

## Intro

요즘 램은 기본적으로 기가 단위 인것 같다. 본인이 초등학생 일 때 카트라이더을 하는데 너무 렉이 심해서, 어떻게 해야하지 알아보다 램을 사서 끼웠던 기억이 있다. 그 당시 컴퓨터들은 하드 10 ~ 25기가에 램은 256MB ~ 512MB가 일반적이었던 것 같다.

그 후에도, 학창시절 당시 신작 고사양 게임들(아이온,마영전 같은)이 출시하면 시작하곤 했었는데, 렉이 걸리거나 실행이 안되면, 한번 해보겠다고 그래픽카드도 바꿔보고, 드라이버도 업데이트하고, 포맷도 하는 등 다양한 시도를 했었던 기억이 난다.

그때 메모리가 부족하다는 에러도 여러번 봤던 것 같은데, 해당 내용에 대해 정리 해보겠다.

<!-- truncate -->

## 메모리란?

컴퓨터의 핵심 부품은 4가지로 CPU, 메모리(주 기억장치), 보조 기억장치, 입출력장치이다.

- CPU: 중앙처리장치(Central Processing Unit)로, 연산 및 제어 기능을 담당
- 주기억장치:
  - RAM(Random Access Memory): 메모리는 주로 RAM을 지칭하며, 읽기와 쓰기가 모두 가능하며, 빠른 속도로 데이터에 접근가능한 휘발성 메모리
  - ROM(Read Only Memory): 컴퓨터 부팅에 필요한 펌웨어, BIOS(Basic Input/Output System) 등을 저장하는 데 사용하는 읽기 전용 비휘발성 메모리
- 보조기억장치: 하드디스크, SSD(Solid State Drive), USB 메모리 등이 포함되며, 대용량의 데이터를 영구적으로 저장할 수 있는 비휘발성 메모리
- 입출력장치: 키보드, 마우스, 스피커, 프린터...

RAM(Random Access Memory)의 의미는 **어떤 메모리 주소에 접근(random access)하더라도 동일한 시간의 읽고 쓰기가 보장되는 것을 의미**한다(하드디스크와 같은 자기 디스크의 경우 데이터가 저장된 주소에 따라 접근하는 시간이 다름).

램에도 DRAM, SRAM, HBM등 종류가 다양한데(잘모름), 기본적인 동작원리는 내부의 트랜지스터로 전기 흐름을 제어 하여 데이터를 저장(전류가 흐를 때를 1, 전류가 흐르지 않을 때를 0)하는 부분일 것이다.

휘발성인 이유는 전기적 신호로 데이터를 저장하기에, 전원 종료시(전기 차단) 전부 0이 되기 때문이고, 보조기억장치들은 데이터를 물리적으로 저장하기에 휘발되지 않는 것이다.

## 프로그램이 메모리 용량보다 크다면?

프로그램 실행과정은 사용자의 실행요청 -> 프로그램 정보를 메모리에 로드 -> 프로그램 코드를 실행 순이다.

게임이든, 내가 작성한 프로그램이던 컴퓨터가 실행 하려면 **반드시 프로그램의 코드와 데이터가 메모리에 로드** 되어야 한다.

그러면 컴퓨터의 가용 메모리보다 큰 프로그램은 실행할 수 없는 걸까? 원래는 그렇다.

이를 극복하기 위해 나온 기술이 가상메모리(Virtual Memory)로 가상메모리를 사용하면 하드디스크의 일부를 메모리처럼 사용하여 실제 물리 메모리보다 큰 용량의 메모리를 사용하는 것처럼 프로그램을 실행할 수 있게 된다.

핵심 개념은 5가지다.

- 가상 주소 공간(Virtual Address Space):
  - 각 프로세스는 자신만의 독립적인 가상 주소 공간을 가짐
  - 가상 주소 공간은 실제 물리 메모리보다 클 수 있음
- 페이징(Paging):
  - 가상 주소 공간과 물리 메모리를 일정한 크기의 블록(페이지)으로 나누어 관리하는 기술
  - 프로세스의 가상 주소 공간은 페이지 단위로 물리 메모리에 매핑
- 페이지 테이블(Page Table):
  - 가상 주소와 물리 주소 간의 매핑 정보를 저장하는 자료구조
  - 각 프로세스는 자신의 페이지 테이블을 가짐
  - 페이지 테이블을 통해 가상 주소를 물리 주소로 변환
- 요구 페이징(Demand Paging):
  - 프로세스 실행에 필요한 페이지를 실제로 사용할 때 메모리에 로드하는 기법
  - 초기에는 프로세스의 모든 페이지를 메모리에 로드하지 않고, 필요한 페이지만 로드
- 페이지 폴트(Page Fault):
  - 프로세스가 접근하려는 페이지가 물리 메모리에 없을 때 발생하는 인터럽트
  - 페이지 폴트가 발생하면 운영체제는 **해당 페이지를 하드디스크에서 물리 메모리로 로드**하고, 프로세스의 실행을 재개
  - 새로운 페이지를 로드 하는 과정에서 기존에 로드 된 페이지와 교체 될 수 있음

<!-- 페이지 폴트 처리로 인한 오버헤드를 최소화하기 위해 효율적인 페이지 교체 알고리즘과 메모리 관리 기법이 필요합니다. -->

## 프로그램 실행과정

메모리 로드과정에 문제가 없다면 프로그램이 실행된다. 여기서 잠깐 프로그램과 프로세스를 짚고 넘어가자면 클래스와 인스턴스처럼 프로그램을 실행 시키면 해당 프로그램의 인스턴스인 프로세스가 생성되어 실행되는 것이다.

프로세스는 운영체제(OS)를 통해 프로그램을 실행하기 위한 메모리 공간을 할당해 주는데, 할당하는 영역은 크게 4가지(Code, Data, Stack, Heap)으로 나뉘어 있다.
| 영역 | 설명 |
|------|------|
| Code(Text) | - 프로그램의 실행 가능한 명령어들이 저장되는 영역 |
| Data | - 전역 변수, 정적 변수, 배열 등이 저장되는 영역<br /> - 프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 해제 |
| Heap | - 동적 메모리 할당을 위해 사용되는 영역<br /> - 힙 영역은 메모리의 낮은 주소에서 높은 주소의 방향으로 할당 |
| Stack | - 지역 변수, 함수 호출 시 전달되는 인자, 함수의 반환 주소 등이 저장되는 영역<br /> - LIFO(Last-In-First-Out) 구조<br /> - 스택 영역은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당 |

<br /> - malloc(), new 등의 연산을 통해 동적으로 메모리 할당<br /> - 프로그래머가 직접 메모리 해제(free(), delete) 필요

- 할당된 메모리 영역 중 사용되지 않는 공간이 발생할 수 있음(단편화)<br /> - 힙 오버플로우(Heap Overflow): 할당 가능한 힙 크기를 초과하여 사용하는 경우 발생<br /> - 메모리 누수(Memory Leak): 동적 할당된 메모리를 해제하지 않고 계속 누적되는 경우 발생 |
- 스택 포인터(SP)를 통해 top 위치 관리<br /> - 스택 오버플로우(Stack Overflow): 할당된 스택 크기를 초과하여 사용하는 경우 발생<br /> - 스택 언더플로우(Stack Underflow): 스택이 비어있는데 pop 연산을 수행하는 경우 발생 |
- <!--  -->

## Stack

## Heap

## 참조

- https://hongong.hanbit.co.kr/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%98-4%EA%B0%80%EC%A7%80-%ED%95%B5%EC%8B%AC-%EB%B6%80%ED%92%88cpu-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%B3%B4%EC%A1%B0%EA%B8%B0%EC%96%B5%EC%9E%A5/
- https://computing-jhson.tistory.com/21
- https://ahnanne.tistory.com/15#4.%20%EC%9A%94%EA%B5%AC%20%ED%8E%98%EC%9D%B4%EC%A7%95(demand%20paging)%EC%9D%B4%EB%9E%80?
